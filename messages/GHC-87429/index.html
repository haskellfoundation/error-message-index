<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex">
  <title>Illegal datatype context [GHC-87429] — Haskell Error Index</title>
  <link rel="stylesheet" href="../../css/highlight.css">
  <script src="../../js/highlight.min.js"></script>
  <link rel="stylesheet" href="../../css/default.css" />
  <link rel="stylesheet" href="../../css/theme.css" />
</head>

<body>
  <main role="main">
    <nav class="breadcrumb">
      
      <a href="../../">The Haskell Error Index</a>&nbsp;»
      
      Illegal datatype context [GHC-87429]
    </nav>
    <h1>Illegal datatype context [GHC-87429]</h1>
    

<p>Without the language extension <code>DatatypeContexts</code> enabled, it is illegal to add constraints to the context of a datatype definition. Whilst this can be solved with enabling <code>DatatypeContexts</code>, <em>however</em> this extension is deprecated and is considered a misfeature. Other solutions to fix this can include:</p>
<ul>
<li>Placing constraints on the <em>use-site</em> of a datatype, or</li>
<li>Using GADTs to place constraints on specific datatype constructors.</li>
</ul>



<h2>Examples</h2>

<details open="open">
  <summary>Illegal datatype context, fixed with use-site constraints</summary>
  <div class="details-inner">
    <p>In this example, we wish to constrain the type <code>a</code> which can parameterise the type <code>D</code> to a type that implements the <code>Show</code> and <code>Read</code> typeclasses. Whilst this can be solved currently by <code>-XDatatypeContexts</code>, this extension is deprecated.</p>
<p>Instead, a solution is to put the constraints on functions that <em>use</em> the datatype.</p>
<h2 id="error-message">Error Message</h2>
<pre><code>IllegalDatatypeContext.hs:5:6: error: [GHC-87429]
    Illegal datatype context (use DatatypeContexts): (Show a) =&gt;
  |
5 | data (Show a) =&gt; D a = D a
  |      ^^^^^^^</code></pre>

<pre class="filename">IllegalDatatypeContext.hs</pre>
<div class="example-container">
  <div class="example">
    <div class="example-inner">
      <div class="example-title">Before</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format properly -->
      <pre class="example-pre"><code class="language-haskell">module IllegalDatatypeContext where

data (Show a) => D a = D a
</code></pre>
    </div>
  </div>
  <div class="example">
    <div class="example-inner">
      <div class="example-title">After</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format propertly -->
      <pre class="example-pre"><code class="language-haskell">module IllegalDatatypeContext where

data D a = D a

f :: (Show a) => D a -> IO ()
f (D d) = putStrLn (show d)
</code></pre>
    </div>
  </div>
</div>


  </div>
</details>

<details open="open">
  <summary>Illegal datatype context, fixed with GADTs</summary>
  <div class="details-inner">
    <p>In this example, we wish to constrain the type <code>a</code> which can parameterise the type <code>D</code> to a type that implements the <code>Show</code> and <code>Read</code> typeclasses. Whilst this can be solved currently by <code>-XDatatypeContexts</code>, this extension is deprecated.</p>
<p>Instead, a solution is to use a GADT to provide a constructor with the given constraints.</p>
<h2 id="error-message">Error Message</h2>
<pre><code>IllegalDatatypeContext.hs:5:6: error: [GHC-87429]
    Illegal datatype context (use DatatypeContexts): (Show a,
                                                      Read a) =&gt;
  |
5 | data (Show a, Read a) =&gt; D a = D a
  |      ^^^^^^^^^^^^^^^^</code></pre>

<pre class="filename">IllegalDatatypeContext.hs</pre>
<div class="example-container">
  <div class="example">
    <div class="example-inner">
      <div class="example-title">Before</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format properly -->
      <pre class="example-pre"><code class="language-haskell">module IllegalDatatypeContext where

data (Show a, Read a) => D a = D a
</code></pre>
    </div>
  </div>
  <div class="example">
    <div class="example-inner">
      <div class="example-title">After</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format propertly -->
      <pre class="example-pre"><code class="language-haskell">{-# LANGUAGE GADTs #-}
module IllegalDatatypeContext where

data D a where
    ShowReadD :: (Show a, Read a) => a -> D a
</code></pre>
    </div>
  </div>
</div>


  </div>
</details>



  </main>

  <footer>
    <p class="HF foot">
      This site is a project of <a href="https://haskell.foundation" target="_blank" rel="noopener noreferrer">The
        Haskell Foundation</a>.
    </p>
    <p class="shoutout foot">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll" target="_blank" rel="noopener noreferrer">Hakyll</a>
    </p>
  </footer>

  <script>document.querySelectorAll('code.language-haskell').forEach(el => {
      hljs.highlightElement(el);
    });</script>
</body>

</html>
