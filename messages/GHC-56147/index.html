<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Rewrite rules are ignored in Safe Haskell [GHC-56147] — Haskell Error Index</title>
  <link rel="stylesheet" href="../../css/highlight.css">
  <script src="../../js/highlight.min.js"></script>
  <link rel="stylesheet" href="../../css/default.css" />
  <link rel="stylesheet" href="../../css/theme.css" />
</head>

<body>
  <main role="main">
    <nav class="breadcrumb">
      
      <a href="../../">The Haskell Error Index</a>&nbsp;»
      
      Rewrite rules are ignored in Safe Haskell [GHC-56147]
    </nav>
    <h1>Rewrite rules are ignored in Safe Haskell [GHC-56147]</h1>
    

<p>GHC implements the <code>SafeHaskell</code> extension which allows programmers to restrict modules to a specific subset which is considered safe and does not contain loopholes such as <code>unsafePerformIO</code>.
More details are available in <a href="https://downloads.haskell.org/ghc/latest/docs/users_guide/exts/safe_haskell.html">the GHC User’s Guide</a>.
One of the features which isn’t considered safe are user-specified rewrite rules. GHC therefore warns that all rewrite rules in a module which is declared safe will be ignored.</p>



<h2>Examples</h2>

<details open="open">
  <summary>Cannot add a rewrite rule for the identity function</summary>
  <div class="details-inner">
    <p>Wanting to rewrite occurrences of <code>myId x</code> to <code>x</code> in programs is sensible. But since GHC cannot check in general whether rewrite rules violate the guarantees of SafeHaskell, GHC chooses to ignore all such rules in modules which are annotated as <code>Safe</code>.These rewrite rules should therefore be removed.</p>
<pre><code>messages/GHC-56147/ignored-rule/before/IgnoredRule.hs:4:11: warning: [GHC-56147]
    Rule &quot;myId&quot; ignored
    Defining user rules is disabled under Safe Haskell
  |
4 | {-# RULES &quot;myId&quot; forall x. myId x = x #-}
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^</code></pre>

<pre class="filename">IgnoredRule.hs</pre>
<div class="example-container">
  <div class="example">
    <div class="example-inner">
      <div class="example-title">Before</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format properly -->
      <pre class="example-pre"><code class="language-haskell">{-# LANGUAGE Safe #-}
module IgnoredRule where

{-# RULES "myId" forall x. myId x = x #-}
myId :: a -> a
myId x = x
</code></pre>
    </div>
  </div>
  <div class="example">
    <div class="example-inner">
      <div class="example-title">After</div>
      <!-- keep next line as is, i.e., on one line, or the code will not format propertly -->
      <pre class="example-pre"><code class="language-haskell">{-# LANGUAGE Safe #-}
module IgnoredRule where


myId :: a -> a
myId x = x
</code></pre>
    </div>
  </div>
</div>


  </div>
</details>



  </main>

  <footer>
    <p class="HF foot">
      This site is a project of <a href="https://haskell.foundation" target="_blank" rel="noopener noreferrer">The
        Haskell Foundation</a>.
    </p>
    <p class="shoutout foot">
      Site proudly generated by
      <a href="http://jaspervdj.be/hakyll" target="_blank" rel="noopener noreferrer">Hakyll</a>
    </p>
  </footer>

  <script>document.querySelectorAll('code.language-haskell').forEach(el => {
      hljs.highlightElement(el);
    });</script>
</body>

</html>
